{"path":"shared-save","templateID":1,"sharedPropsHashes":{"apiList":"ZBJJOF"},"localProps":{"reference":{"title":"共有セーブを利用する","slug":"shared-save","description":"RPGアツマール内で動作する特定のサーバーセーブデータを取得するAPIです","order":26,"experimental":true,"recommendTheory":true,"contents":"<h2 id=\"-\">概要</h2>\n<p>指定ユーザーの特定キー（<code>Atsumaru Shared</code>）のサーバーセーブデータを取得できる機能です。<br>このセーブデータのことを「共有セーブ」と呼びます。</p>\n<h3 id=\"-\">なにができるのか</h3>\n<p>指定ユーザーの共有セーブを取得できます。この機能だけでは誰からデータを取得すればいいのかわかりませんが、他APIと組み合わせることにより、非同期通信型のゲームが制作可能になります。<br>例えば、<a href=\"/user\">ユーザー情報API</a>で、そのゲームを最近プレイしたユーザーがわかるので、そのユーザーの共有セーブに保存されたデータ（例えばアイテムなど）を取得することで、疑似的なすれ違い通信のようなゲームが作成できます。\nなお、未ログインユーザーは共有セーブをサーバーに保存できませんが、他人の共有セーブを取得することについては問題なく行えます。</p>\n<h4 id=\"-\">利用想定／利用例</h4>\n<p>この機能は、以下のような使い方を想定しています。</p>\n<ul>\n<li>選択したアバターと一言メッセージを保存し、表示する広場</li>\n<li>作成したモンスターキャラクターのデータ共有</li>\n</ul>\n<p>例えば、次のサンプルゲームではこの機能を利用し、選択したアバターと一言メッセージを共有セーブに保存しています。</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm9291\">【ゲームAPIサンプル】AsyncProfile（ユーザー情報取得API・共有セーブAPI）</a><ul>\n<li><a href=\"/download/sample-projects#AsyncProfile\">プロジェクトファイルダウンロードはこちら</a></li>\n</ul>\n</li>\n</ul>\n<p>また、こちらのサンプルゲームでは、作成したスライムの情報を共有セーブに保存し、ほかのユーザーの作成したスライムと戦わせています。（バトルの結果は、<a href=\"/signal\">ユーザーシグナル</a>で送信しています）</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm9294\">【ゲームAPIサンプル】スライムバトラー（ユーザーシグナルAPI・共有セーブAPI）</a><ul>\n<li><a href=\"/download/sample-projects#SlimeBattler\">プロジェクトファイルダウンロードはこちら</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-\">機能詳細</h2>\n<ul>\n<li>共有対象のデータは、<code>Atsumaru Shared</code> というkeyで保存されたサーバーセーブデータです。<ul>\n<li>セーブの保存については<a href=\"/storage\">こちら</a>を参照ください。</li>\n<li>共有対象にしたくないデータは、このkeyを使わないようにご注意ください。</li>\n</ul>\n</li>\n<li>本機能でできるのは共有セーブの <strong>取得のみ</strong> で、共有元への書き込みはできません。</li>\n<li>一度に取得できるデータは100件までで、それ以上のデータを一度に取得しようとするとエラーになります。</li>\n</ul>\n<h3 id=\"-\">他のゲームの共有セーブへのアクセス禁止条件</h3>\n<p>取得先のゲームと取得元のゲームが同じ場合、共有セーブへのアクセスは必ず認められます。一方で他のゲームの共有セーブを取得する場合は、以下の条件のうちいずれかに該当した場合、アクセス禁止となり <a href=\"/common/errors\">FORBIDDEN</a> エラーが返されます。</p>\n<ul>\n<li>取得先のゲームが公開されていない<ul>\n<li>ただし取得先のゲームの作者本人は、取得先のゲームが公開されていなくても例外的に共有セーブを取得できます</li>\n</ul>\n</li>\n<li>取得先のゲームと取得元のゲームの作者が違う</li>\n</ul>\n<h3 id=\"-\">共有セーブ取得の絞り込み条件</h3>\n<p>前節にかかわらず、以下の条件を満たした共有セーブは取得できません。その場合、取得できるユーザーの共有セーブのみに絞り込まれて返されます。</p>\n<ul>\n<li>指定したユーザーが存在しない</li>\n<li>指定したユーザーの共有セーブが無い</li>\n<li>指定したユーザーが<a href=\"/common/interplayer\">プレイヤー間通信の有効化</a>をしていない<ul>\n<li>ただし、自分自身の共有セーブはプレイヤー間通信の有効化をしていなくてもセーブを取得できます</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-\">利用方法</h2>\n<p>共有セーブ機能は次の方法で利用できます。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">場所</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">公式プラグイン</td>\n<td align=\"left\"><a href=\"https://github.com/atsumaru/mv-plugins/blob/master/plugins/AtsumaruSharedSaveExperimental.js\">Github</a></td>\n</tr>\n<tr>\n<td align=\"left\">ゲームAPI</td>\n<td align=\"left\">以下の「APIでの利用方法」を参考に、直接APIを呼び出してください</td>\n</tr>\n</tbody></table>\n<h3 id=\"-\">公式プラグインの利用方法</h3>\n<h4 id=\"-\">プラグイン設置方法</h4>\n<ol>\n<li>プロジェクトのプラグインフォルダに <a href=\"https://raw.githubusercontent.com/atsumaru/mv-plugins/master/plugins/AtsumaruSharedSaveExperimental.js\">AtsumaruSharedSaveExperimental.js</a> を右クリックし「保存」して設置。</li>\n<li>プロジェクトのプラグイン設定で <code>AtsumaruSharedSaveExperimental</code> プラグインをONにする。</li>\n</ol>\n<h4 id=\"-\">共有セーブの保存</h4>\n<p>自分のデータを共有セーブとして保存する場合、プラグインコマンドは次のいずれかのように指定します。（どちらでも動作は同じです）</p>\n<pre><code>SetSharedSave\n共有セーブ保存</code></pre><p>プラグイン設定画面の <code>共有セーブの保存範囲(開始)</code> と <code>共有セーブの保存範囲(終了)</code> に設定した範囲のツクール変数が、自分の共有セーブデータとして保存されます。</p>\n<h4 id=\"-\">共有セーブの取得</h4>\n<p>他人の共有セーブを取得して変数に代入する場合、プラグインコマンドは次のいずれかのように指定します。（どちらでも動作は同じです）</p>\n<pre><code>GetSharedSave {userIdVariableId} {startVariableId}\n共有セーブ取得 {userIdVariableId} {startVariableId}</code></pre><p><code>{userIdVariableId}</code> で指定した変数からユーザーIDを読み取り、そのユーザーの共有セーブを <code>{startVariableId}</code> を先頭にして代入します。</p>\n<p>例：変数1番からユーザーIDを読み取り、そのユーザーの共有セーブを変数201番以降に展開（たとえば共有セーブの保存範囲が101-150で計50個の場合、201-250に代入）</p>\n<pre><code>共有セーブ取得 1 201</code></pre><p>ただし、読み取る相手が<a href=\"/common/interplayer\">プレイヤー間通信の有効化</a>をしていないと、共有セーブを取得できないことにご注意ください。</p>\n<h3 id=\"api-\">APIでの利用方法</h3>\n<h4 id=\"-\">共有セーブの取得</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.experimental.storage.getSharedItems(userIds: number[], gameId?: number)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">指定したユーザの <code>Atsumaru Shared</code> というキーで保存したセーブデータを取得する。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\"><ul><li><code>userIds</code> : 共有セーブを取得したいユーザーのニコニコユーザーIDの配列を自然数で、最大100件まで指定します。</li><li><code>gameId</code> : 現在プレイ中のゲーム以外からセーブデータを取得する場合、ゲームのIDを自然数で指定します。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;SharedSaveItems&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n</tbody></table>\n<ul>\n<li><code>userIds</code> で指定したユーザーのセーブデータユーザーのデータを取得できます。</li>\n<li>第二引数の <code>gameId</code> を指定することで、別のゲームの共有セーブを取得できます。</li>\n</ul>\n<h5 id=\"-sharedsaveitems-\">戻り値の型 SharedSaveItems について</h5>\n<p>戻り値で取得できる <code>SharedSaveItems</code> は以下のような型です。</p>\n<pre><code class=\"language-js\">interface SharedSaveItems {\n  [userId: number]: string;\n}</code></pre>\n<p>プロパティの内容は次のようになっています。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">プロパティ名</th>\n<th align=\"left\">型</th>\n<th align=\"left\">内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">[userId: number]</td>\n<td align=\"left\"><code>string</code></td>\n<td align=\"left\"><code>userId</code> のIDのユーザーの共有セーブデータを収納します。</td>\n</tr>\n</tbody></table>\n<h5 id=\"-\">戻り値の例</h5>\n<pre><code class=\"language-js\">// window.RPGAtsumaru.experimental.storage.getSharedItems([123, 456, 789]).then(function(v) { console.log(v) }) を実行\n{\n  123: &quot;ユーザー123の共有データ&quot;,\n  456: &quot;ユーザー456の共有データ&quot;\n  // 789 のユーザーが取得先のゲームで「プレイヤー間通信の有効化」されていない場合は結果に含まれません！\n}</code></pre>\n<h5 id=\"-\">起こりうるエラーの種類</h5>\n<table>\n<thead>\n<tr>\n<th align=\"left\">名前</th>\n<th align=\"left\">説明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><a href=\"/common/errors\">BAD_REQUEST</a></td>\n<td align=\"left\">引数として不正な値を指定している</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">FORBIDDEN</a></td>\n<td align=\"left\"><code>gameId</code> にアクセス不能なゲームのIDを指定した場合</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">INTERNAL_SERVER_ERROR</a></td>\n<td align=\"left\">RPGアツマールのサービス側で何らかの問題が発生しているか、または通信に失敗した</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">API_CALL_LIMIT_EXCEEDED</a></td>\n<td align=\"left\">短時間にゲームAPIを利用しすぎて、一時的に利用を制限されている</td>\n</tr>\n</tbody></table>\n"},"title":"共有セーブを利用する","path":"/shared-save"}}
