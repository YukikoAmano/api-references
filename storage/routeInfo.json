{"path":"storage","templateID":1,"sharedPropsHashes":{"apiList":"2tuV5n"},"localProps":{"reference":{"title":"セーブを保存する","slug":"storage","description":"セーブ機能を利用するにはStorageAPIを利用してください。","order":12,"contents":"<h2 id=\"-\">概要</h2>\n<p>StorageAPIを使うと、ゲーム内のデータをセーブしたり、セーブしたデータを取得することができます。</p>\n<p>保存したセーブデータはユーザーのログイン状態や通信状況などによって、一時セーブまたはサーバーセーブとして保存されます（詳しくは<a href=\"https://qa.nicovideo.jp/faq/show/6584\">こちら</a>）が、ゲーム作者側はそれを意識することなくセーブデータを読み書きできます。</p>\n<p>セーブに成功した場合、以下のようなポップアップが表示されます。</p>\n<p><img src=\"https://atsumaru.github.io/api-references/images/storage.png\" alt=\"セーブ\"></p>\n<h3 id=\"rpg-localstorage-\">RPGアツマールの localStorage の扱いについて</h3>\n<p>RPGアツマール上でlocalStorageを使用した場合は、内部的にはこのStorageAPIが代わりに動作します。</p>\n<h3 id=\"-\">利用想定／利用例</h3>\n<p>前節の通り、RPGツクールMVを含む <code>localStorage</code> を利用するゲームエンジンは、自動的にこの機能を利用していることになります。例えば以下のゲームがこの機能を利用してセーブを実行しています。</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm7601\">【防衛ゲーム】タタの魔法使い【異世界サバイバル】</a></li>\n</ul>\n<h2 id=\"-\">詳細</h2>\n<p>Stringを保存するシンプルなKVS（Key-Valueストア)になっています。セーブはゲームID(gm123等)ごとに独立しています。\nセーブデータの保存領域にはニコニコユーザーIDごとに上限があります。1kbで1ブロックとして、90ブロックまで保存ができます。セーブデータは保存時に自動的に圧縮され、圧縮後のファイルサイズを見ています。StorageAPIは複数端末からセーブされることを想定しています。</p>\n<h3 id=\"-key-\">保存のkeyについて</h3>\n<p><code>RPG Config</code>、<code>RPG Global</code>、<code>RPG FileN</code> (Nは数字) の3種の key は、RPGツクールMVのエンジンに組み込まれている <code>lzstring.js</code> によって、圧縮されたデータを読み書きするように設計されています。そのため、RPGツクールMV以外のゲームがこの key を利用すると、データが正しく処理されず、破損する可能性があります。RPGツクールMV以外ではこれらの key にセーブしないようにご注意ください。</p>\n<p>またRPGツクールMVは <code>RPG Config</code> に、デバイスごとの共通設定項目（音量設定や常時ダッシュ設定など）を保存するように設計されています。\nそのため、この key だけはすべてのゲームで共通のデータとなります。</p>\n<p>推奨のkeyは <code>system</code> と <code>dataN</code>(Nは数字) と <code>Atsumaru Shared</code> です。この3種の key はRPGアツマール側のセーブ管理画面で、それぞれ「システムファイル」「ファイル N」「共有セーブ」として扱われます。これら以外はゲーム上で「その他」と表示されます。また、共有セーブについては他のユーザーからもデータを読み取ることができる特徴があります。詳しくは<a href=\"/shared-save\">共有セーブ</a>を参照してください。</p>\n<h2 id=\"-\">利用方法</h2>\n<p>セーブ機能は次の方法で利用できます。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">場所</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">localStorageを使う</td>\n<td align=\"left\">内部的に、以下のAPIに差し替えられます</td>\n</tr>\n<tr>\n<td align=\"left\">ゲームAPI</td>\n<td align=\"left\">以下の「APIでの利用方法」を参考に、直接APIを呼び出してください</td>\n</tr>\n</tbody></table>\n<h3 id=\"api-\">APIでの利用方法</h3>\n<p>APIを利用したセーブ機能の利用です。</p>\n<h4 id=\"-api\">セーブ全件取得API</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.storage.getItems()</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">保存されているセーブデータを全件取得します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">なし</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;{key: string, value: string}[]&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2019/03/18</td>\n</tr>\n</tbody></table>\n<h4 id=\"-api\">セーブ保存API</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.storage.setItems(items: {key: string, value: string}[])</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">引数に指定したitemsに対応するセーブデータを保存します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">更新する対象のセーブ情報。型は {key: string, value: string}[]</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;void&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2019/03/18</td>\n</tr>\n</tbody></table>\n<h5 id=\"-\">利用例</h5>\n<pre><code class=\"language-js\">window.RPGAtsumaru.storage.setItems([\n  { key: &quot;キー名&quot;, value: JSON.stringify(someObject) }\n]);</code></pre>\n<h4 id=\"-api\">セーブ削除API</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.storage.removeItem(key: string)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">指定したセーブデータを削除します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">削除対象のセーブのキー。型はstring</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;void&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2019/03/18</td>\n</tr>\n</tbody></table>\n"},"title":"セーブを保存する","path":"/storage"}}
