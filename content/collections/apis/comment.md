---
title: コメント
slug: comment
description: ユーザー同士でゲーム体験を共有できるコメント機能について
order: 6
navi: 機能解説
---
    
## 概要
RPGアツマールでは、ユーザーのゲーム体験を共有するためにコメント機能を提供しています。設計はRPGツクールMVでの利用を想定していますがAPIは汎用的にも利用可能です。
  
    
## なにができるのか
ゲームの内容に合わせてコメントを投稿・表示できます。
    
## 例
RPGツクールMV製ゲームの場合、RPGアツマールが挿入する `rpgatsumaru.js` によって自動的にこの機能を利用しています。
  
例えば以下のゲームで、この機能を利用してゲーム上にコメントを表示しています。
 -  [【防衛ゲーム】タタの魔法使い【異世界サバイバル】](https://game.nicovideo.jp/atsumaru/games/gm7601)
    
## 詳細
本機能を実行した際に、次のような操作を行います。
 - コメントシステムのscene設定
 - sceneの切り替え
 - contextfactorの設定
 - contextの設定
 - minorcontextの設定
  
コメント機能は「コメントシステム」にゲーム状態を伝えると、コメントがゲーム上に流れます。ゲームは動画と異なり、時系列のようにプレイヤー全員が共有しているコンテンツの内部状態が存在しないため、ゲームでは逐次ゲーム状態をコメントシステムに伝える必要があります。この「ゲーム状態」のことを本システムではgame position(**gpos**)と呼んでいます。
  
RPGツクールMVにおいては、イベントコマンドごとにgposをコメントシステムに伝達しています。そのため、例えば「ヒロインのセリフ」など特定の状態をプレイヤー間で共有できます。もし、あなたがアクションゲームをつくるなら「敵を倒した」「アイテムを得た」などのイベントをgposとしてコメントシステムに伝えることになります。
  
gpos は scene と contextfactor と minorcontext という３つのパラメーターで表現します。プログラム的に書けば以下のようになります。
  
```
gpos(scene, context(contextfactor[0,-1,-2]), minorcontext)
```
  
scene はコメントデータ群を表しています。scene 1つあたりで最新1,000件(※変更可能性有り)で、直近5つの scene をAPI側でキャッシュします。一般的なゲームではマップや戦闘画面、メニュー画面に相当します。
  
scene のコメントを、context の値で指定し取得することでコメントが描画されます。context は状態遷移マシンになっており、contextfactor を push することで状態が1つ進みます。状態は最新の contextfactor 3つの複合キーで表されています。context をさらに細かく分割する場合、たとえば「あるイベント内の時間」などを示すには minorcontext が便利です。minorcontext を push するごとに状態が細かく進み、それに応じたコメントが描画されます。
  
RPGツクールMVにおいては scene は map の id に対応します。contextfactor は「セリフ」コマンドと「選択肢」コマンドで、minorcontext は「ウェイト」コマンドと、コマンド内の wait に対応します。minorcontext があることで、「セリフのあとにキャラクターが移動して演技する」ような演出に対して細かくコメントができます。
    
![概念図](/images/comment.png)
    
## 利用方法

方式|利用方法|備考
:---|:---|:---
API|APIでの利用方法の「[コメント](/apis/comment)」項を参考に、APIを実装してください|他ゲームエンジンやより高度な利用を必要とするユーザー向け
    
※プラグインはありません
    
## 最終更新日
 - 2020/02/28
