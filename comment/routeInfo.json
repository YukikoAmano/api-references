{"path":"comment","templateID":1,"sharedPropsHashes":{"apiList":"Z2bsMi6"},"localProps":{"reference":{"title":"コメントを利用する","slug":"comment","description":"RPGアツマールのコメント機能を利用するにはCommentAPIを利用してください。","order":10,"contents":"<h2>概要</h2>\n<p>RPGアツマールでは、ユーザーのゲーム体験を共有するためにコメント機能を提供しています。設計はRPGツクールMVでの利用を想定していますがAPIは汎用的にも利用可能です。</p>\n<h3>なにができるのか</h3>\n<p>ゲームの内容に合わせてコメントを投稿・表示できます。  </p>\n<h4>利用想定／利用例</h4>\n<p>RPGツクールMV製ゲームの場合、RPGアツマールが挿入する <code>rpgatsumaru.js</code> によって自動的にこの機能を利用しています。例えば以下のゲームで、この機能を利用してゲーム上にコメントを表示しています。</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm7601\">【防衛ゲーム】タタの魔法使い【異世界サバイバル】</a><ul>\n<li>ゲーム開始時（scene=<code>__title</code>）などで、右から左にコメントが流れます。</li>\n</ul>\n</li>\n</ul>\n<h2>機能詳細</h2>\n<p>本機能を実行した際に、次のような操作を行います。</p>\n<ul>\n<li>コメントシステムのscene設定</li>\n<li>sceneの切り替え</li>\n<li>contextfactorの設定</li>\n<li>contextの設定</li>\n<li>minorcontextの設定</li>\n</ul>\n<p>コメント機能は「コメントシステム」にゲーム状態を伝えると、コメントがゲーム上に流れます。ゲームは動画と異なり、時系列のようにプレイヤー全員が共有しているコンテンツの内部状態が存在しないため、ゲームでは逐次ゲーム状態をコメントシステムに伝える必要があります。この「ゲーム状態」のことを本システムではgame position(<strong>gpos</strong>)と呼んでいます。</p>\n<p>RPGツクールMVにおいては、イベントコマンドごとにgposをコメントシステムに伝達しています。そのため、例えば「ヒロインのセリフ」など特定の状態をプレイヤー間で共有できます。もし、あなたがアクションゲームをつくるなら「敵を倒した」「アイテムを得た」などのイベントをgposとしてコメントシステムに伝えることになります。</p>\n<p>gpos は scene と contextfactor と minorcontext という３つのパラメーターで表現します。プログラム的に書けば以下のようになります。</p>\n<pre><code>gpos(scene, context(contextfactor[0,-1,-2],minorcontext))</code></pre><p>scene はコメントデータ群を表しています。scene 1つあたりで最新1,000件(※変更可能性有り)で、直近5つの scene をAPI側でキャッシュします。一般的なゲームではマップや戦闘画面、メニュー画面に相当します。</p>\n<p>scene のコメントを、context の値で指定し取得することでコメントが描画されます。\ncontext は状態遷移マシンになっており、contextfactor を push することで状態が1つ進みます。状態は contextfactor 3つの複合キーで表されています。\n1つの状態内でさらに細かく分割する場合、たとえば「あるイベント内の時間」などを示すには minorcontext が便利です。minorcontext を push するごとに状態が細かく進み、それに応じたコメントが描画されます。</p>\n<p>RPGツクールMVにおいては scene は map の id に対応します。\ncontextfactor は「セリフ」コマンドと「選択肢」コマンドで、minorcontext は「ウェイト」コマンドと、コマンド内の wait に対応します。minorcontext があることで、「セリフのあとにキャラクターが移動して演技する」ような演出に対して細かくコメントができます。</p>\n<p><img src=\"https://atsumaru.github.io/api-references/images/comment.png\" alt=\"概念図\"></p>\n<h2>利用方法</h2>\n<p>コメント機能は次の方法で利用できます。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">場所</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">ゲームAPI</td>\n<td align=\"left\">以下の「APIでの利用方法」を参考に、直接APIを呼び出してください</td>\n</tr>\n</tbody></table>\n<h3>APIでの利用方法</h3>\n<p>APIを利用したコメント機能の利用</p>\n<h4>シーン設定API</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.changeScene(sceneName: string)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムのシーンを設定する。</li><li>シーンが切り替わると、そのシーンのコメント空間に切り替わる。</li><li>ツクールでは基本的にマップID=シーン名となる。</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>シーン名は64文字までのascii限定。</li></ul><br>※なお、アンダースコア２つで始まるシーン名は特殊用途として予約されています。<br>予約されている中で現在利用可能なシーン名は <code>__title</code> と <code>__gameover</code> の2つで、 <code>__title</code> は内部状態の初期値になっています。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">シーン名を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h4>シーン切り替えAPI</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.resetAndChangeScene(sceneName: string)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>changeSceneと違い、context(contextfactorとminorcontext)による内部状態をリセットしつつシーンを切り替える</li><li>サーバーアクセスが発生する。（ただし直近5つのsceneはキャッシュされ、再アクセスには発生しない）</li><li>ツクール製ゲームではタイトルとゲームオーバーで全員同じコメントが流れる機能のために使用しています。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">シーン名を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h4>コンテキストファクターAPI</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.pushContextFactor(factor: string)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムにContextFactorとなる値(ツクールでいうセリフと選択肢)をpushして、contextを更新する。</li><li>contextが更新されたことでgposが更新され、文脈にあわせたコメントが流れる。</li><li>また、minorcontextを初期化する。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">コメントシステムにpushするコンテキストを表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h4>マイナーコンテキストAPI</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.pushMinorContext()</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>コメントシステムのgposを更新する。</li><li>contextが更新されたことでgposKeyが更新され、文脈にあわせたコメントが流れる。</li><li>内部的にminorcontext値を持っており、それを+1することでgposを更新している。pushContextFactorを使うと、minorcontext値は初期値に戻される。</li><li>MinorContextは「ContextFactorのさらに細かい状態」を想定している。</li><li>ツクールではエンジンにwaitがかかるような命令で使用している。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h4>コンテキストAPI</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.setContext(context: string)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>pushContextFactorと違い、contextを引数に渡した値で直接書き換える。</li><li>特定のScene内でまったく同じゲーム状態を厳密に作りたい場合に使う。</li><li>このときの context の値は、ascii 64文字以下推奨。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">コンテキスト値を表す文字列</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\">無し</td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2016/12/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/10/25</td>\n</tr>\n</tbody></table>\n<h4>表示コメント取得API</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.cameOut.subscribe(observer: Observer)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>ゲーム画面に流れるコメントを取得できるAPIです。</li><li>表示前のコメントは取得できません。</li><li>Observer, subscriptionについてはESNextのObservableを参照してください。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">RPGアツマールのコメント情報( <code>{command: string, content: string}[]</code> )を受け取るObserver</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>subscription</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2017/07/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/11/25</td>\n</tr>\n</tbody></table>\n<h4>表示コメント取得コールバックAPI</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.cameOut.subscribe(next: (comment: {command: string, content: string}[]) =&gt; void)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><code>window.RPGAtsumaru.comment.cameOut.subscribe(observer)</code> の引数に、コールバック関数を受け付けられるようにしたものです。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">RPGアツマールのコメント情報( <code>{command: string, content: string}[]</code> )を受け取るコールバック</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>subscription</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2017/07/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/11/25</td>\n</tr>\n</tbody></table>\n<h4>入力コメント取得API</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.posted.subscribe(observer: Observer)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><ul><li>ユーザが投稿したコメント情報を取得できるAPIです。</li><li>Observer, subscriptionについてはESNextのObservableを参照してください。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">RPGアツマールのコメント情報( <code>{command: string, content: string}</code> )を受け取るObserver</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>subscription</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2017/07/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/11/25</td>\n</tr>\n</tbody></table>\n<h4>入力コメント取得コールバックAPI</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.posted.subscribe(next: (comment: {command: string, content: string}) =&gt; void)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\"><code>window.RPGAtsumaru.comment.posted.subscribe(observer)</code> の引数に、コールバック関数を受け付けられるようにしたものです。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\">RPGアツマールのコメント情報( <code>{command: string, content: string}</code> )を受け取るコールバック</td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>subscription</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2017/07/27</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/11/25</td>\n</tr>\n</tbody></table>\n<h4>verboseモードAPI</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">変数</th>\n<th align=\"left\"><code>window.RPGAtsumaru.comment.verbose</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">trueをセットすると、コメントのgpos(game position)計算の内部情報をコンソールに出力します</td>\n</tr>\n<tr>\n<td align=\"left\">型</td>\n<td align=\"left\"><code>boolean</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2017/09/19</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/11/25</td>\n</tr>\n</tbody></table>\n<h5>verboseモードAPIのコンソールの出力例</h5>\n<pre><code>gamePos updated.\n  texts: hoge/fuga/piyo\n  increment: 1</code></pre>"},"title":"コメントを利用する","path":"/comment"}}
