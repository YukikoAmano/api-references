{"path":"signal","templateID":1,"sharedPropsHashes":{"apiList":"16v79X"},"localProps":{"reference":{"title":"シグナルを送信する","slug":"signal","description":"ゲーム内で、他のユーザーと小さなデータ（信号）をやり取りするためのAPIです。","order":28,"experimental":true,"recommendTheory":true,"contents":"<h2 id=\"-\">概要</h2>\n<p>ユーザー間で小さなデータ（信号）をやり取りできる機能です。<br>シグナルAPIには、そのゲームのプレイヤー全体に対する「グローバルシグナル」と個別ユーザー間の「ユーザーシグナル」があります。  </p>\n<p><img src=\"https://atsumaru.github.io/api-references/images/signal_concept_global.png\" alt=\"グローバルシグナルAPI概念図\">\n<img src=\"https://atsumaru.github.io/api-references/images/signal_concept_user.png\" alt=\"ユーザーシグナルAPI概念図\"></p>\n<h3 id=\"-\">なにができるのか</h3>\n<ul>\n<li>グローバルシグナルは、そのゲームをプレイしているユーザー全体への信号を送信できます。全プレイヤーのプレイログを取得したり、全員アイテムプレゼントなどが可能になります。</li>\n<li>ユーザーシグナルは、ユーザーIDで指定した相手に対して信号を送信できます。共有セーブと組み合わせて、所持アイテムの交換や、キャラクターの貸し出しなどが可能になります。</li>\n</ul>\n<h4 id=\"-\">利用想定／利用例</h4>\n<p>この機能は、以下のような使い方を想定しています。</p>\n<ul>\n<li>グローバルシグナル：全ユーザーの行動ログの送信、全ユーザーへ影響を与える指示</li>\n<li>ユーザーシグナル：個別ユーザー間での指示</li>\n</ul>\n<p>例えば、次のサンプルゲームではグローバルシグナルを利用し、他ユーザーのプレイ状況を表示しています。</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm9292\">【ゲームAPIサンプル】プレイローグ（グローバルシグナルAPI・グローバルサーバー変数API）</a><ul>\n<li><a href=\"/download/sample-projects#PlayLog\">プロジェクトファイルダウンロードはこちら</a></li>\n</ul>\n</li>\n</ul>\n<p>また、こちらのサンプルゲームでは、ユーザーシグナルを利用して、スライムのバトル結果を送信しています。（スライムの情報は<a href=\"/shared-save\">共有セーブ</a>を<a href=\"/user\">最近プレイしたユーザー</a>から取得しています）</p>\n<ul>\n<li><a href=\"https://game.nicovideo.jp/atsumaru/games/gm9294\">【ゲームAPIサンプル】スライムバトラー（ユーザーシグナルAPI・共有セーブAPI）</a><ul>\n<li><a href=\"/download/sample-projects#SlimeBattler\">プロジェクトファイルダウンロードはこちら</a></li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-\">機能詳細</h2>\n<ul>\n<li>シグナルとは、最大100byteの任意の文字データです。</li>\n<li>受信できるシグナルにはサイズ・個数ともに上限があります。制限を回避するには、なるべく小さなサイズのシグナルを推奨します。</li>\n<li>制限詳細<ul>\n<li>1シグナルのデータ上限は100byteまでです。</li>\n<li>積まれたシグナルは古いシグナルから順々に押し出され削除されます。</li>\n<li>グローバルシグナルは、1ゲームあたり1,000件までです。</li>\n<li>ユーザーシグナルは、1ユーザーあたり100KBまでです。更にその中で、ゲームあたり1ユーザー1,000件または10KBまでとなります。<ul>\n<li>特に100KBまでの制限はゲーム間共通のため、シグナルが他ゲームからのシグナル送受信によって押し出される可能性があります。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"-\">利用方法</h2>\n<p>シグナル機能は次の方法で利用できます。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">方法</th>\n<th align=\"left\">場所</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">公式プラグイン</td>\n<td align=\"left\"><ul><li><a href=\"https://github.com/atsumaru/mv-plugins/blob/master/plugins/AtsumaruGlobalSignalExperimental.js\">グローバルシグナル</a></li><li><a href=\"https://github.com/atsumaru/mv-plugins/blob/master/plugins/AtsumaruUserSignalExperimental.js\">ユーザーシグナル</a></li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">ゲームAPI</td>\n<td align=\"left\">以下の「APIでの利用方法」を参考に、直接APIを呼び出してください</td>\n</tr>\n</tbody></table>\n<h3 id=\"-\">公式プラグインの利用方法</h3>\n<h4 id=\"-\">グローバルシグナルプラグインの設置方法</h4>\n<ol>\n<li>プロジェクトのプラグインフォルダに <a href=\"https://raw.githubusercontent.com/atsumaru/mv-plugins/master/plugins/AtsumaruGlobalSignalExperimental.js\">AtsumaruGlobalSignalExperimental.js</a> を右クリックし「保存」して設置。</li>\n<li>プロジェクトのプラグイン設定で <code>AtsumaruGlobalSignalExperimental</code> プラグインをONにする。</li>\n<li>プラグイン設定画面で、取得したグローバルシグナルの収納先変数を設定する。</li>\n</ol>\n<h4 id=\"-\">グローバルシグナルの送信</h4>\n<p>変数の値をグローバルシグナルとして送信する場合、プラグインコマンドは次のいずれかのように指定します。（どちらでも動作は同じです）</p>\n<pre><code>SendGlobalSignal {signalDataVariableId}\nグローバルシグナル送信 {signalDataVariableId}</code></pre><p>変数{signalDataVariableId}からデータを読み取り、グローバルシグナルとして送信します。</p>\n<h4 id=\"-\">グローバルシグナルの取得</h4>\n<p>グローバルシグナルを取得して変数に代入する場合、プラグインコマンドは次のいずれかのように指定します。（どちらでも動作は同じです）</p>\n<pre><code>GetGlobalSignal\nグローバルシグナル取得</code></pre><p>まだ取得していないグローバルシグナルの中で最も古いものを一件読み込み、プラグイン設定で指定した変数に代入します。また、取得後に今回取得したものを含めた残りのシグナルの個数が「残シグナル数」にセットされます。</p>\n<ul>\n<li>残シグナル数が0だった場合は、サーバーに未取得のシグナルがなかったため、シグナルデータと送信者のユーザーID/名前には0がセットされています。</li>\n<li>残シグナル数が0または1だった場合は、次に取得コマンドを実行するときに新たなシグナルの受信を試みます。(2以上の場合はすでに受信したデータを返すため、新たに受信はしません)<ul>\n<li>この際、短期間の連続受信にはプラグインで制限をかけているため、時間がかかることがあります。</li>\n<li>そのため、取得コマンドの待ち時間を短くしたい場合は、残シグナル数が0または1のときは次の取得コマンドの実行までに１０秒以上の時間を空けてください。</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"-\">ユーザーシグナルプラグインの設置方法</h4>\n<ol>\n<li>プロジェクトのプラグインフォルダに <a href=\"https://raw.githubusercontent.com/atsumaru/mv-plugins/master/plugins/AtsumaruUserSignalExperimental.js\">AtsumaruUserSignalExperimental.js</a> を右クリックし「保存」して設置。</li>\n<li>プロジェクトのプラグイン設定で <code>AtsumaruUserSignalExperimental</code> プラグインをONにする。</li>\n<li>プラグイン設定画面で、取得したユーザーシグナルの収納先変数を設定する。</li>\n</ol>\n<h4 id=\"-\">ユーザーシグナルの送信</h4>\n<p>変数の値をユーザーシグナルとして送信する場合、プラグインコマンドは次のいずれかのように指定します。（どちらでも動作は同じです）</p>\n<pre><code>SendUserSignal {signalDataVariableId} {userIdVariableId}\nユーザーシグナル送信 {signalDataVariableId} {userIdVariableId}</code></pre><p>変数{signalDataVariableId}からデータを読み取り、それをシグナルとします。変数{userIdVariableId}からユーザーIDを読み取り、そのIDのユーザーにシグナルを送信します。</p>\n<h4 id=\"-\">ユーザーシグナルの取得</h4>\n<p>ユーザーシグナルを取得して変数に代入する場合、プラグインコマンドは次のいずれかのように指定します。（どちらでも動作は同じです）</p>\n<pre><code>GetUserSignal\nユーザーシグナル取得</code></pre><p>まだ取得していないユーザーシグナルの中で最も古いものを一件読み込み、プラグイン設定で指定した変数に代入します。また、取得後に今回取得したものを含めた残りのシグナルの個数が「残シグナル数」にセットされます。</p>\n<ul>\n<li>残シグナル数が0だった場合は、サーバーに未取得のシグナルがなかったため、シグナルデータと送信者のユーザーID/名前には0がセットされています。</li>\n<li>残シグナル数が0または1だった場合は、次に取得コマンドを実行するときに新たなシグナルの受信を試みます。(2以上の場合はすでに受信したデータを返すため、新たに受信はしません)<ul>\n<li>この際、短期間の連続受信にはプラグインで制限をかけているため、時間がかかることがあります。</li>\n<li>そのため、取得コマンドの待ち時間を短くしたい場合は、残シグナル数が0または1のときは次の取得コマンドの実行までに１０秒以上の時間を空けてください。</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"api-\">APIでの利用方法</h3>\n<h4 id=\"-\">グローバルシグナルの送信</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.experimental.signal.sendSignalToGlobal(data: string)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">ゲームのグローバルシグナルとして <code>data</code> で指定した文字列を送信します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\"><ul><li><code>data</code> : シグナルとして、任意の文字列を100byte以内で送信できます。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;void&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n</tbody></table>\n<ul>\n<li>補足事項<ul>\n<li>グローバルシグナルはゲームあたり1,000件まで保存されます。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"-\">起こりうるエラーの種類</h5>\n<table>\n<thead>\n<tr>\n<th align=\"left\">名前</th>\n<th align=\"left\">説明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><a href=\"/common/errors\">UNAUTHORIZED</a></td>\n<td align=\"left\">プレイヤーがログインしていない</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">BAD_REQUEST</a></td>\n<td align=\"left\"><ul><li><code>data</code> に100byte以上の文字列を指定した</li><li>引数として不正な値を指定している</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">INTERNAL_SERVER_ERROR</a></td>\n<td align=\"left\">RPGアツマールのサービス側で何らかの問題が発生しているか、または通信に失敗した</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">API_CALL_LIMIT_EXCEEDED</a></td>\n<td align=\"left\">短時間にゲームAPIを利用しすぎて、一時的に利用を制限されている</td>\n</tr>\n</tbody></table>\n<h4 id=\"-\">グローバルシグナルの取得</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.experimental.signal.getGlobalSignals()</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">送信されたゲームのグローバルシグナルを取得します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;GlobalSignal[]&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n</tbody></table>\n<ul>\n<li>補足事項<ul>\n<li>グローバルシグナルはゲームあたり1,000件まで保存されます。</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"-globalsignal-\">戻り値の型 GlobalSignal について</h5>\n<p>戻り値で取得できる <code>GlobalSignal</code> は以下のような型です。</p>\n<pre><code class=\"language-js\">interface GlobalSignal {\n    id: number;\n    senderId: number;\n    senderName: string;\n    data: string;\n    createdAt: number;\n}</code></pre>\n<p>プロパティの内容は次のようになっています。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">プロパティ名</th>\n<th align=\"left\">型</th>\n<th align=\"left\">内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">id</td>\n<td align=\"left\"><code>number</code></td>\n<td align=\"left\">シグナルそれぞれでユニークなID値</td>\n</tr>\n<tr>\n<td align=\"left\">senderId</td>\n<td align=\"left\"><code>number</code></td>\n<td align=\"left\">シグナルを送信したユーザーのニコニコユーザーID</td>\n</tr>\n<tr>\n<td align=\"left\">senderName</td>\n<td align=\"left\"><code>string</code></td>\n<td align=\"left\">シグナルを送信したユーザーのユーザー名</td>\n</tr>\n<tr>\n<td align=\"left\">data</td>\n<td align=\"left\"><code>string</code></td>\n<td align=\"left\">送信したシグナル文字列</td>\n</tr>\n<tr>\n<td align=\"left\">createdAt</td>\n<td align=\"left\"><code>number</code></td>\n<td align=\"left\">シグナルが送信された日時(秒単位のunix timestamp)。すでに処理済みのシグナルを判別するために用います。</td>\n</tr>\n</tbody></table>\n<h5 id=\"-\">戻り値の例</h5>\n<pre><code class=\"language-js\">// window.RPGAtsumaru.experimental.signal.getGlobalSignals().then(function(v) { console.log(v) }) を実行\n[\n  {\n    createdAt: 1543397700,\n    data: &quot;test data&quot;,\n    id: 3,\n    senderId: 12345,\n    senderName: &quot;user1&quot;\n  },\n  {\n    createdAt: 1543397701,\n    data: &quot;test data2&quot;,\n    id: 4,\n    senderId: 12346,\n    senderName: &quot;user2&quot;\n  },\n]</code></pre>\n<h5 id=\"-\">起こりうるエラーの種類</h5>\n<table>\n<thead>\n<tr>\n<th align=\"left\">名前</th>\n<th align=\"left\">説明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><a href=\"/common/errors\">INTERNAL_SERVER_ERROR</a></td>\n<td align=\"left\">RPGアツマールのサービス側で何らかの問題が発生しているか、または通信に失敗した</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">API_CALL_LIMIT_EXCEEDED</a></td>\n<td align=\"left\">短時間にゲームAPIを利用しすぎて、一時的に利用を制限されている</td>\n</tr>\n</tbody></table>\n<h4 id=\"-\">ユーザーシグナルの送信</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.experimental.signal.sendSignalToUser(receiverId: number, data: string)</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">ユーザーシグナルとして <code>receiverId</code> で指定したユーザーIDのユーザーに <code>data</code> で指定した文字列を送信します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\"><ul><li><code>receiverId</code> : 送信先のニコニコユーザーIDを指定します。</li><li><code>data</code> : シグナルとして、任意の文字列を100byte以内で送信できます。</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;void&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n</tbody></table>\n<ul>\n<li>補足事項<ul>\n<li>ユーザーシグナルは、ユーザーあたり100KBまで保存されます。<ul>\n<li>他のゲームからのシグナル送信によっても消える可能性があります。</li>\n</ul>\n</li>\n<li>また、ゲームあたり1ユーザー10KBまたは1000件までとなります。<ul>\n<li>ゲームからのシグナル送信によって、古いシグナルから消えていきます。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"-\">起こりうるエラーの種類</h5>\n<table>\n<thead>\n<tr>\n<th align=\"left\">名前</th>\n<th align=\"left\">説明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><a href=\"/common/errors\">UNAUTHORIZED</a></td>\n<td align=\"left\">プレイヤーがログインしていない</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">FORBIDDEN</a></td>\n<td align=\"left\"><code>userId</code> に<a href=\"/common/interplayer\">プレイヤー間通信の有効化</a>を行っていないユーザーのIDを指定した</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">BAD_REQUEST</a></td>\n<td align=\"left\"><ul><li><code>data</code> に100byte以上の文字列を指定した</li><li>引数として不正な値を指定している</li></ul></td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">INTERNAL_SERVER_ERROR</a></td>\n<td align=\"left\">RPGアツマールのサービス側で何らかの問題が発生しているか、または通信に失敗した</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">API_CALL_LIMIT_EXCEEDED</a></td>\n<td align=\"left\">短時間にゲームAPIを利用しすぎて、一時的に利用を制限されている</td>\n</tr>\n</tbody></table>\n<h4 id=\"-\">ユーザーシグナルの取得</h4>\n<table>\n<thead>\n<tr>\n<th align=\"left\">メソッド</th>\n<th align=\"left\"><code>window.RPGAtsumaru.experimental.signal.getUserSignals()</code></th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">説明</td>\n<td align=\"left\">プレイしているユーザーのユーザーシグナルを取得します。</td>\n</tr>\n<tr>\n<td align=\"left\">引数</td>\n<td align=\"left\"></td>\n</tr>\n<tr>\n<td align=\"left\">戻り値</td>\n<td align=\"left\"><code>Promise&lt;UserSignal[]&gt;</code></td>\n</tr>\n<tr>\n<td align=\"left\">リリース日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n<tr>\n<td align=\"left\">更新日</td>\n<td align=\"left\">2018/12/17</td>\n</tr>\n</tbody></table>\n<ul>\n<li>補足事項<ul>\n<li>ユーザーシグナルは、ユーザーあたり100KBまで保存されます。<ul>\n<li>他のゲームからのシグナル送信によっても消える可能性があります。</li>\n</ul>\n</li>\n<li>また、ゲームあたり1ユーザー10KBまたは1000件までとなります。<ul>\n<li>ゲームからのシグナル送信によって、古いシグナルから消えていきます。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"-usersignal-\">戻り値の型 UserSignal について</h5>\n<p>戻り値で取得できる <code>UserSignal</code> は以下のような型です。</p>\n<pre><code class=\"language-js\">interface UserSignal {\n    id: number;\n    senderId: number;\n    senderName: string;\n    data: string;\n    createdAt: number;\n}</code></pre>\n<p>プロパティの内容は次のようになっています。</p>\n<table>\n<thead>\n<tr>\n<th align=\"left\">プロパティ名</th>\n<th align=\"left\">型</th>\n<th align=\"left\">内容</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\">id</td>\n<td align=\"left\"><code>number</code></td>\n<td align=\"left\">シグナルそれぞれでユニークなID値</td>\n</tr>\n<tr>\n<td align=\"left\">senderId</td>\n<td align=\"left\"><code>number</code></td>\n<td align=\"left\">シグナルを送信したユーザーのニコニコユーザーID</td>\n</tr>\n<tr>\n<td align=\"left\">senderName</td>\n<td align=\"left\"><code>string</code></td>\n<td align=\"left\">シグナルを送信したユーザーのユーザー名</td>\n</tr>\n<tr>\n<td align=\"left\">data</td>\n<td align=\"left\"><code>string</code></td>\n<td align=\"left\">送信したシグナル文字列</td>\n</tr>\n<tr>\n<td align=\"left\">createdAt</td>\n<td align=\"left\"><code>number</code></td>\n<td align=\"left\">シグナルが送信された日時(秒単位のunix timestamp)。すでに処理済みのシグナルを判別するために用います。</td>\n</tr>\n</tbody></table>\n<h5 id=\"-\">戻り値の例</h5>\n<pre><code class=\"language-js\">// window.RPGAtsumaru.experimental.signal.getUserSignals().then(function(v) { console.log(v) }) を実行\n[\n  {\n    createdAt: 1543397700,\n    data: &quot;test data&quot;,\n    id: 3,\n    senderId: 12345,\n    senderName: &quot;user1&quot;\n  },\n  {\n    createdAt: 1543397701,\n    data: &quot;test data2&quot;,\n    id: 4,\n    senderId: 12346,\n    senderName: &quot;user2&quot;\n  },\n]</code></pre>\n<h5 id=\"-\">起こりうるエラーの種類</h5>\n<table>\n<thead>\n<tr>\n<th align=\"left\">名前</th>\n<th align=\"left\">説明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td align=\"left\"><a href=\"/common/errors\">UNAUTHORIZED</a></td>\n<td align=\"left\">プレイヤーがログインしていない</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">INTERNAL_SERVER_ERROR</a></td>\n<td align=\"left\">RPGアツマールのサービス側で何らかの問題が発生しているか、または通信に失敗した</td>\n</tr>\n<tr>\n<td align=\"left\"><a href=\"/common/errors\">API_CALL_LIMIT_EXCEEDED</a></td>\n<td align=\"left\">短時間にゲームAPIを利用しすぎて、一時的に利用を制限されている</td>\n</tr>\n</tbody></table>\n"},"title":"シグナルを送信する","path":"/signal"}}
